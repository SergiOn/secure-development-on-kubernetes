<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Kubernetes und Container - Aber Sicher!</title>
        <meta name="description" content="Kubernetes und Container - Aber Sicher!">
        <meta name="author" content="Andreas Falk">

		<link rel="stylesheet" href="css/reset.css">
		<link rel="icon" href="images/cropped-novatec-favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="images/cropped-novatec-favicon-192x192.png" sizes="192x192" />


        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="css/reset.css">
        <link rel="stylesheet" href="css/reveal.css">
        <link href="css/theme/novatec.css" id="theme" rel="stylesheet">

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

                <!-- Title, Speaker and Session Introduction -->
                <section>
                    <section data-background="images/novatec_title_back.png">
                        <p>&nbsp;</p>
                        <h3 style="color: white">Kubernetes und Container - Aber Sicher!</h3>
                        <p style="color: white">Andreas Falk / @andifalk</p>
                        <p style="color: white">
                            <small>
                            Slides: <a href="https://andifalk.github.io/kubernetes-container-aber-sicher">https://andifalk.github.io/kubernetes-container-aber-sicher</a><br>
                            Source-Code: <a href="https://github.com/andifalk/kubernetes-container-aber-sicher">https://github.com/andifalk/kubernetes-container-aber-sicher</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <img class="plain" src="images/andreas_falk.jpg" width="40%">
                        <p><strong>Andreas Falk</strong></p>
                        <p><strong>Novatec Consulting GmbH</strong></p>
                        <p><small>
                            <a href="https://www.novatec-gmbh.de/">https://www.novatec-gmbh.de</a><br>
                            andreas.falk@novatec-gmbh.de / @andifalk<br>
                        </small></p>
                        <p><img class="plain" src="images/novatec_logo_big.png" width="40%"></p>
                    </section>
                </section>

                <section>
                    <section data-background="images/novatec_title_back.png">
                        <p>&nbsp;</p>
                        <h1 style="color: white">K8s & Containers</h1>
                        <h4 style="color: white">What could go wrong here?</h4>
                    </section>
                    <section>
                        <h4>Challenges in Kubernetes</h4>
                        <img src="images/new-stack-securitytop.png" width="78%" class="plain">
                        <p>
                            <small>
                                <a href="https://thenewstack.io/top-challenges-kubernetes-users-face-deployment/">Source: https://thenewstack.io</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h4>Severe vulnerability in Kubernetes</h4>
                        <img src="images/kubernetes_severe_vulnerability.png" width="85%" class="plain">
                        <p>
                            <small>
                                <a href="https://blog.aquasec.com/kubernetes-security-cve-2018-1002105">Source: https://blog.aquasec.com</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h4>Crypto mining via K8s dashboard</h4>
                        <img src="images/tesla_hack.png" width="77%" class="plain">
                        <p>
                            <small>
                                <a href="https://blog.heptio.com/on-securing-the-kubernetes-dashboard-16b09b1b7aca">Source: https://blog.heptio.com</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h4>Open etcd (1)</h4>
                        <img src="images/shodan.png" width="77%" class="plain">
                        <p>
                            <small>
                                <a href="https://shodan.io">https://shodan.io</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h4>Open etcd (2)</h4>
                        <img src="images/shodan.png" width="50%" class="plain">
                        <pre><code class="hljs bash" data-trim>
                            $ etcdctl --endpoints=http://xx.xx.xx.xx:2379 cluster-health
                            member b97ee4034db41d17 is healthy: got healthy result
                            from http://xx.xx.xx.xx:2379
                            cluster is healthy
                        </code></pre>
                        <p>
                            <small>
                                <a href="https://github.com/etcd-io/etcd/releases">https://github.com/etcd-io/etcd/releases</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Vulnerable docker images</h3>
                        <img src="images/docker_images_vulnerabilities.png" class="plain" width="100%">
                        <p>
                            <small>
                                <a href="https://snyk.io/opensourcesecurity-2019/">Source: The state of open source security report (snyk.io)</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h4>All is root!</h4>
                        <img src="images/tweet_kubernetes_all_root.png" width="100%" class="plain">
                    </section>
                    <section>
                        <h3>Root without Password!</h3>
                        <img src="images/alpine_docker_cve.png" class="plain" width="75%">
                    </section>
                    <section>
                        <h2>What's in this session</h2>
                        <p>Docker Security 101</p>
                        <p>Kubernetes 101</p>
                        <p>Secure Kubernetes Deployment (Live Demo)</p>
                        <p>Kubernetes Security Best Practices</p>
                    </section>
                </section>

                <!-- Introduction into Docker (Security) -->
                <section>
                    <section data-background="images/novatec_title_back.png">
                        <h1 style="color: white">Docker Security</h1>
                        <h1 style="color: white">101</h1>
                    </section>
                    <section>
                        <h3>Docker Security Basics</h3>
                        <p>
                            <img src="images/docker_security.png" class="plain" width="80%">
                        </p>
                    </section>
                    <section>
                        <h3>Container Images</h3>
                        <p>
                            <img src="images/docker_container_security.png" class="plain" width="80%">
                        </p>
                    </section>
                    <section>
                        <h3>Image Security</h3>
                        <p>
                            <img src="images/container_image_security.png" class="plain" width="100%">
                        </p>
                    </section>
                </section>

                <!-- Introduction into K8s -->
                <section>
                    <section data-background="images/novatec_title_back.png">
                        <h1 style="color: white">Kubernetes</h1>
                        <h1 style="color: white">101</h1>
                    </section>
                    <section>
                        <h2>Kubernetes Basics</h2>
                        <p>
                            <img src="images/kubernetes_basics.png" class="plain" width="100%">
                        </p>
                        <p>
                            <small>
                                By courtesy of Matthias Haeussler (@maeddes)
                            </small>
                        </p>
                    </section>
                </section>


                <!-- Live Demo Part -->
                <section>
                    <section data-background="images/novatec_title_back.png">
                        <h1 style="color: white">Secure K8s Deployment</h1>
                        <h5 style="color: white"><strong>Live Demos</strong></h5>
                        <p style="color: white">
                            <small>
                                Demos-Code: <a href="https://github.com/andifalk/kubernetes-container-aber-sicher">https://github.com/andifalk/kubernetes-container-aber-sicher</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Deployment Steps</h3>
                        <p>
                            <img src="images/appsecurity_kubernetes_complete.png" class="plain" width="100%">
                        </p>
                    </section>
                    <section>
                        <h3>Application Security</h3>
                        <p>
                            <img src="images/appsecurity_kubernetes_step1.png" class="plain" width="100%">
                        </p>
                    </section>
                    <section>
                        <h3>Application Security</h3>
                        <p>
                            <img src="images/appsecurity.png" class="plain" width="100%">
                        </p>
                    </section>
                    <section>
                        <h3>Demo Time - Show me the Code</h3>
                        <p>
                            <small>
                                <a href="https://github.com/andifalk/kubernetes-container-aber-sicher/tree/master/initial-spring-boot-app">Demo-Code: Initial Spring Boot Application</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Container Security</h3>
                        <p>
                            <img src="images/appsecurity_kubernetes_step2.png" class="plain" width="100%">
                        </p>
                    </section>
                    <section>
                        <h1>Say no to Root</h1>
                        <p><em>USER</em> directive in Dockerfile</p>
                        <p>
                            <small>
                                <a href="https://opensource.com/article/18/3/just-say-no-root-containers">Just say no to root containers</a><br>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Say no to Root</h3>
                        <p>Dockerfile</p>
                        <pre><code class="hljs bash" data-trim>
                            FROM openjdk:11-jre-slim
                            COPY hello-spring-kubernetes-1.0.0-SNAPSHOT.jar app.jar
                            EXPOSE 8080
                            RUN addgroup --system --gid 1002 app && adduser
                                --system --uid 1002 --gid 1002 appuser
                            USER 1002
                            ENTRYPOINT java -jar /app.jar
                        </code></pre>
                    </section>
                    <section>
                        <h3>Vulnerabilities in well-know images</h3>
                        <img src="images/docker_images_vulnerabilities.png" class="plain" width="100%">
                        <p>
                            <small>
                                <a href="https://snyk.io/opensourcesecurity-2019/">Source: The state of open source security report (snyk.io)</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h2>Keep being secure</h2>
                        <p>Perform image scanning (Anchore, Clair, ...)</p>
                        <p>Regularly update your (base) images</p>
                        <p>Checkout Google Distroless Images</p>
                        <p>
                            <small>
                                <a href="https://anchore.com/opensource/">https://anchore.com/opensource</a><br>
                                <a href="https://github.com/coreos/clair">https://github.com/coreos/clair</a><br>
                                <a href="https://docs.docker.com/ee/dtr/">https://docs.docker.com/ee/dtr (Docker Trusted Registry)</a><br>
                                <a href="https://github.com/GoogleContainerTools/distroless">https://github.com/GoogleContainerTools/distroless</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Demo Time - Show me the Code</h3>
                        <p>
                            <small>
                                <a href="https://github.com/andifalk/kubernetes-container-aber-sicher/tree/master/initial-spring-boot-app">Demo-Code: Initial Spring Boot Application</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Kubernetes Security</h3>
                        <p>
                            <img src="images/appsecurity_kubernetes_step3.png" class="plain" width="100%">
                        </p>
                    </section>
                    <section>
                        <h1>Say no to Root</h1>
                        <p><em>USER</em> directive in Dockerfile</p>
                        <p>K8s Security Context for a Pod/Container</p>
                        <p>Pod Security Policy (Beta)</p>
                        <p>
                            <small>
                                <a href="https://opensource.com/article/18/3/just-say-no-root-containers">Just say no to root containers</a><br>
                                <a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/">Pod Security Policy</a><br>
                                <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/">Pod Security Context</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Helm is Root on K8s</h3>
                        <img src="images/helm_3_tweet.png" width="100%" class="plain">
                    </section>
                    <section>
                        <h3>Keep being secure</h3>
                        <ul>
                        <li>Restrict ports & enable authentication <br>(api-server/etcd/kubelet)</li>
                        <li>Configure network policies</li>
                        <li>Use role-based access control (RBAC)</li>
                        <li>Regularly update kubernetes version</li>
                        </ul>
                        <p>
                            <small>
                                <a href="https://kubernetes.io/docs/tasks/administer-cluster/securing-a-cluster/">Securing a Cluster</a><br>
                                <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Kubernetes RBAC</a><br>
                                <a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">Kubernetes Network Policies</a><br>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Keep being secure (cont'd)</h3>
                        <ul>
                            <li>Enable node patching (Reboot nodes)</li>
                            <li>Monitor your cluster & apps</li>
                            <li>Enable K8s auditing</li>
                            <li>Log all the things</li>
                        </ul>
                        <p>
                            <small>
                                <a href="https://github.com/weaveworks/kured">Kubernetes Reboot Daemon</a>
                                <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/">K8s Monitoring, Logging, and Debugging</a><br>
                                <a href="https://www.fluentd.org/">Fluentd Log Collector</a><br>
                                <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/audit/">Kubernetes Auditing</a><br>
                                <a href="https://prometheus.io/">Prometheus</a><br>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Demo Time - Show me the Code</h3>
                        <p>
                            <small>
                                <a href="https://github.com/andifalk/kubernetes-container-aber-sicher/tree/master/initial-spring-boot-app">Demo-Code: Initial Spring Boot Application</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Kubernetes Secrets</h3>
                        <p>
                            <img src="images/appsecurity_kubernetes_step4.png" class="plain" width="100%">
                        </p>
                    </section>
                    <section>
                        <h3>K8s Config Maps</h3>
                        <pre><code class="hljs yml" data-trim>
                                kind: ConfigMap
                                apiVersion: v1
                                metadata:
                                  name: hello-spring-cloud-kubernetes
                                  namespace: default
                                data:
                                  hello.message: k8s
                                  hello.prefix: Hi
                        </code></pre>
                        <pre><code class="hljs yml" data-trim>
                                data:
                                  application.properties: |-
                                    hello.message=k8s
                                    hello.prefix=Hi
                        </code></pre>
                        <pre><code class="hljs yml" data-trim>
                                data:
                                  application.yaml: |-
                                    hello:
                                      message: k8s
                                      prefix: Hi
                        </code></pre>
                    </section>
                    <section>
                        <h3>K8s Secrets</h3>
                        <pre><code class="hljs yml" data-trim>
                            apiVersion: v1
                            kind: Secret
                            metadata:
                              name: hello-spring-cloud-kubernetes
                              namespace: default
                            type: Opaque
                            data:
                              user.username: dXNlcg==
                              user.password: azhzX3VzZXI=
                              admin.username: YWRtaW4=
                              admin.password: azhzX2FkbWlu
                        </code></pre>
                        <p style="color: red">Secrets in <em>etcd</em> DB are NOT encrypted with default settings !!</p>
                        <p>Just Base64 encoded!</p>
                    </section>
                    <section>
                        <h3>Why protect Secrets?</h3>
                        <p>Attractive target for hackers</p>
                        <p>Easily leak to repos, logs, ...</p>
                        <p>Violation of &ldquo;Least Privilege&rdquo; principle</p>
                    </section>
                    <section>
                        <h3>Best Practice for secrets</h3>
                        <p>Do not use K8s API for reading secrets</p>
                        <blockquote cite="https://kubernetes.io/docs/concepts/configuration/secret/#best-practices">
                            "Listing secrets allows the clients to inspect the values of all secrets that are in that namespace."
                        </blockquote>
                        <p>
                            <small>
                                <a href="https://kubernetes.io/docs/concepts/configuration/secret/#best-practices">https://kubernetes.io/docs/concepts/configuration/secret/#best-practices</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Best Practice for secrets</h3>
                        <p>
                            <img src="images/secrets_env_vars_tweet.png" class="plain" width="58%">
                        </p>
                    </section>
                    <section>
                        <h3>Encryption Layers</h3>
                        <p>
                            <img src="images/encryption_layers.png" class="plain" width="80%">
                        </p>
                    </section>
                    <section>
                        <h3>Envelope Encryption on K8S</h3>
                        <p>
                            <img src="images/envelope_encryption.png" class="plain" width="100%">
                        </p>
                        <p>Supported as of kubernetes version 1.10</p>
                        <p>
                            <small>
                                <a href="https://cloud.google.com/kms/docs/envelope-encryption">https://cloud.google.com/kms/docs/envelope-encryption</a><br>
                                <a href="https://kubernetes.io/docs/tasks/administer-cluster/kms-provider/">https://kubernetes.io/docs/tasks/administer-cluster/kms-provider/</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Cloud KMS</h3>
                        <h5><a href="https://azure.microsoft.com/en-us/services/key-vault/">Azure Key Vault</a></h5>
                        <h5><a href="https://cloud.google.com/kms/">Google Cloud KMS</a></h5>
                        <h5><a href="https://aws.amazon.com/kms/">AWS KMS</a></h5>
                        <h5><a href="https://github.com/oracle/kubernetes-vault-kms-plugin">Hashicorp Vault KMS Plugin</a></h5>
                    </section>
                    <section data-background="images/novatec_title_back.png">
                        <h1 style="color: white">Spring Cloud Kubernetes</h1>
                        <p>
                            <small>
                                <a href="https://spring.io/projects/spring-cloud-kubernetes">https://spring.io/projects/spring-cloud-kubernetes</a><br>
                                <a href="https://cloud.spring.io/spring-cloud-kubernetes/spring-cloud-kubernetes.html">https://cloud.spring.io/spring-cloud-kubernetes/spring-cloud-kubernetes.html</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h2>Features</h2>
                        <ul>
                            <li>DiscoveryClient for Kubernetes (Ribbon Support)</li>
                            <li>ConfigMapPropertySource</li>
                            <li>SecretsPropertySource</li>
                            <li>Kubernetes Ecosystem Awareness</li>
                            <li>Kubernetes Profile</li>
                            <ul>
                                <li><a href="https://github.com/spring-cloud/spring-cloud-kubernetes/issues/347">Issue 347: Profile Specific Configuration Not Loaded</a></li>
                            </ul>
                            <li>Pod Health Indicator</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Demo Time - Show me the Code</h3>
                        <p>
                            <small>
                                <a href="https://github.com/andifalk/kubernetes-container-aber-sicher/tree/master/initial-spring-boot-app">Demo-Code: Initial Spring Boot Application</a>
                            </small>
                        </p>
                    </section>
                </section>

                <!-- The End -->
                <section>
                    <section data-background="images/novatec_title_back.png" data-background-size="100%">
                        <h1 style="color: white">The End</h1>
                    </section>
                    <section>
                        <h2>Summary / Key Insights</h2>
                        <ul>
                            <li>Configs, Secrets & Discovery the &ldquo;Spring Way&rdquo;
                                <br>-- More to come: Istio & Helm awareness, ...</li>
                            <li><span style="color: red">&ldquo;Least privilege&rdquo;</span> for service accounts</li>
                            <li>Ensure your secrets are <span style="color: red">encrypted</span> in K8s</li>
                            <li>Say <span style="color: red">NO</span> to root on K8s</li>
                            <li>Keep K8s and container images <span style="color: red">up-to-date</span></li>
                        </ul>
                    </section>
                    <section data-background="images/novatec_final_back.png" data-background-size="100%">
                        <div style="alignment: left; text-align: left">
                        <h1 style="color: white">Q&A</h1>
                        <a href="https://www.novatec-gmbh.de/">https://www.novatec-gmbh.de</a></br>
                        <a href="https://blog.novatec-gmbh.de/">https://blog.novatec-gmbh.de</a><br>
                        <p style="color: white">andreas.falk@novatec-gmbh.de<br>
                        Twitter: @andifalk</p>
                        </div>
                    </section>
                </section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
                hash: true,
                fragmentInURL: false,
                dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
            Reveal.configure({
                slideNumber: 'c/t',
                pdfMaxPagesPerSlide: 1
            });
		</script>
	</body>
</html>
